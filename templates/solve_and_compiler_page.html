<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solve - {{ q.title if q else 'No Question' }}</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs/loader.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- <link rel="stylesheet" href="static, filename='css/student_and_compiler_page.css"> -->
      <link rel="stylesheet" href="{{  url_for('static', filename='css/solve_and_compiler_page.css')  }}">
    <style>
        .label-heading { font-weight: 700; color: #333; margin-top: 1.5rem; }
        #editor { border-radius: 8px; border: 1px solid #ddd; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        pre { font-family: 'Consolas', 'Monaco', 'Courier New', monospace; font-size: 0.9rem; margin: 0; }
        .sample-card { border: 1px solid #e0e0e0; transition: transform 0.2s; }
        .compiler-section { background: #ffffff; padding: 2rem; border-radius: 12px; margin-top: 3rem; border: 1px solid #dee2e6; }
        .test-pass { border-left: 5px solid #198754; }
        .test-fail { border-left: 5px solid #dc3545; }
        .spinner-border-sm { margin-right: 8px; }
    </style>
</head>
<body class="bg-light">
<h2 class="hello">hello o </h2>
<div class="container py-5">
    <div class="card shadow-sm border-0 p-4 mb-4">
        <div class="d-flex justify-content-between align-items-center">
            <h1 class="fw-bold text-primary m-0">{{ q.title }}</h1>
            <span class="badge bg-dark px-3 py-2">{{ q.difficulty }}</span>
        </div>
        <p class="text-muted mt-2">Display ID: <strong>{{ q.question_id }}</strong></p>
        <hr>
        <p class="lead text-dark">{{ q.description }}</p>

        <div class="row">
            <div class="col-md-6">
                <h5 class="label-heading">Input Format</h5>
                <p>{{ q.input_format }}</p>
            </div>
            <div class="col-md-6">
                <h5 class="label-heading">Output Format</h5>
                <p>{{ q.output_format }}</p>
            </div>
        </div>

        <h4 class="fw-bold mt-4 mb-3 text-success">Sample Test Cases</h4>
        <div class="row">
            {% for case in q.test_cases[:3] %}
            <div class="col-12 mb-2">
                <div class="card sample-card border-0 shadow-sm">
                    <div class="row g-0">
                        <div class="col-md-6 border-end p-2">
                            <span class="small fw-bold text-secondary">INPUT</span>
                            <pre class="bg-light p-2 rounded">{{ case.input_data }}</pre>
                        </div>
                        <div class="col-md-6 p-2">
                            <span class="small fw-bold text-secondary">EXPECTED</span>
                            <pre class="bg-light p-2 rounded">{{ case.expected_output }}</pre>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <div class="compiler-section shadow-sm">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h3 class="fw-bold m-0">Editor</h3>
            <select id="language" class="form-select w-25" onchange="changeLang()">
                <option value="python">Python</option>
                <option value="c">C</option>
                <option value="cpp">C++</option>
                <option value="java">Java</option>
            </select>
        </div>

        <div id="editor" style="height: 400px;"></div>

    </div>
</div>
    

    <div class="submission">
        <div class="col-md-5" >
            <h6 style="margin-left: 170px;">Compiler</h6>
                <h5 class="fw-bold mb-3">Custom Input</h5>
                <textarea id="custom-input" class="custom-input" rows="3" placeholder="Enter input for manual testing..."></textarea>
                <div class="d-grid gap-2 d-md-block">
                    <button id="run-btn" class="btn btn-outline-secondary fw-bold" onclick="handleRun(false)">Run Code</button>
                    </div>
            </div>
        </div>
    </div>


    
    <div class="submission-console">
        <div class="custom-input">
                <div id="test-results-container"></div>
                <h5 class="fw-bold mt-3 mb-2">Console Output</h5>
                <pre id="output-console" class="bg-dark text-white p-3 rounded" style="min-height: 100px; max-height: 300px; overflow-y: auto;"></pre>
                <button id="submit-btn" class="btn btn-success fw-bold px-4" onclick="handleRun(true)">Submit & Test All</button>
            </div>
    </div>

            

    



<script>
    let editor;
    
    // 1. Code State Management
    const codeState = {
        python: "# Write Your Python Code here\nprint('Hello World')",
        c: "#include <stdio.h>\n\nint main() {\n    printf(\"Hello World\");\n    return 0;\n}",
        cpp: "#include <iostream>\nusing namespace std;\n\nint main() {\n    cout << \"Hello World\";\n    return 0;\n}",
        java: "import java.io.*; \nimport java.util.*; \npublic class Main {\n    public static void main(String[] args) {\n        System.out.println(\"Hello World\");\n    }\n}"
    };

    // 2. Test Cases from Backend
    const testCases = [
        {% for case in q.test_cases %}
        { id: {{ loop.index }}, input: {{ case.input_data | tojson }}, expected: {{ case.expected_output | tojson }} }{% if not loop.last %},{% endif %}
        {% endfor %}
    ];

    // 3. Initialize Monaco with "No Copy/Paste" Security
    require.config({ paths: { vs: "https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs" } });
    require(["vs/editor/editor.main"], function () {
        
        
        editor = monaco.editor.create(document.getElementById("editor"), {
    value: codeState.python,
    language: "python",
    theme: "light",
    automaticLayout: true,
    
    // 1. STOP HORIZONTAL SCROLL
    wordWrap: "on",
    wrappingStrategy: "advanced",

    // 2. STOP VERTICAL BARS & TRACKS
    scrollbar: {
        vertical: 'hidden',
        horizontal: 'hidden',
        handleMouseWheel: true, // Still allows scrolling with wheel
        verticalScrollbarSize: 0,
        horizontalScrollbarSize: 0,
        useShadows: false
    },

    // 3. REMOVE SIDEBAR ELEMENTS
    minimap: { enabled: false },           // Disables the map on the right
    overviewRulerLanes: 0,                 // Removes error/warning lane
    overviewRulerBorder: false,            // Removes lane border
    hideCursorInOverviewRuler: true,
    scrollBeyondLastLine: false,           // Stops extra bottom space
    glyphMargin: false,                    // Removes left-side margin for breakpoints
    folding: false                         // Removes code folding arrows
});
        // Block Paste via Keyboard (Ctrl+V / Cmd+V)
        editor.addCommand(monaco.KeyMod.CtrlCmd | monaco.KeyCode.KeyV, () => {
            alert("Pasting is disabled for this challenge!");
        });

        // Block Copy via Keyboard (Ctrl+C / Cmd+C)
        editor.addCommand(monaco.KeyMod.CtrlCmd | monaco.KeyCode.KeyC, () => {
            alert("Copying is disabled!");
        });
    });

    // 4. Global Browser Protection
    document.addEventListener('copy', (e) => { e.preventDefault(); return false; });
    document.addEventListener('paste', (e) => { e.preventDefault(); return false; });
    document.addEventListener('cut', (e) => { e.preventDefault(); return false; });
    document.addEventListener('contextmenu', (e) => { e.preventDefault(); return false; });

    // 5. Execution Logic
    async function handleRun(isFullTest) {
        const consoleElem = document.getElementById("output-console");
        const resultsElem = document.getElementById("test-results-container");
        const btn = isFullTest ? document.getElementById("submit-btn") : document.getElementById("run-btn");
        const lang = document.getElementById("language").value;
        const code = editor.getValue();

        const originalBtnText = btn.innerHTML;
        btn.innerHTML = `<span class="spinner-border spinner-border-sm"></span> Running...`;
        btn.disabled = true;
        
        try {
            if (!isFullTest) {
                const input = document.getElementById("custom-input").value;
                const data = await apiCall(code, lang, input);
                consoleElem.textContent = data.output || data.error || "No output";
            } else {
                for (const test of testCases) {
                    const data = await apiCall(code, lang, test.input);
                    const isCorrect = normalize(data.output) === normalize(test.expected) && !data.error;

                    const div = document.createElement("div");
                    div.className = `alert ${isCorrect ? 'alert-success' : 'alert-danger'} py-2 mb-2`;
                    div.innerHTML = `Case #${test.id}: ${isCorrect ? 'Passed ✓' : 'Failed ✗'}`;
                    resultsElem.appendChild(div);

                    if (data.error || !isCorrect) break;
                }
            }
        } finally {
            btn.innerHTML = originalBtnText;
            btn.disabled = false;
        }
    }

    async function apiCall(code, language, input) {
        const res = await fetch("/run", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ code, language, input })
        });
        return await res.json();
    }

    function normalize(str) {
        return str ? str.toString().trim().replace(/\r\n/g, "\n") : "";
    }

    function changeLang() {
        const select = document.getElementById("language");
        const newLang = select.value;
        const prevLang = select.getAttribute("data-prev") || 'python';

        codeState[prevLang] = editor.getValue();
        monaco.editor.setModelLanguage(editor.getModel(), newLang === "cpp" ? "cpp" : newLang);
        editor.setValue(codeState[newLang]);
        select.setAttribute("data-prev", newLang);
    }
</script>

</html>