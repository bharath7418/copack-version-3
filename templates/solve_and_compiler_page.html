<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solve - {{ q.title if q else 'No Question' }}</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs/loader.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/solve_and_compiler_page.css') }}">
    
    <style>
        .label-heading { font-weight: 700; color: #333; margin-top: 1.5rem; }
        #editor { border-radius: 8px; border: 1px solid #ddd; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        pre { font-family: 'Consolas', 'Monaco', 'Courier New', monospace; font-size: 0.9rem; margin: 0; }
        .sample-card { border: 1px solid #e0e0e0; transition: transform 0.2s; }
        .sample-card:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .compiler-section { background: #ffffff; padding: 2rem; border-radius: 12px; margin-top: 3rem; border: 1px solid #dee2e6; }
    </style>
</head>
<body class="bg-light">

<div class="container py-5">
    <div class="card shadow-sm border-0 p-4 mb-4">
        <div class="d-flex justify-content-between align-items-center">
            <h1 class="fw-bold text-primary m-0">{{ q.title }}</h1>
            <span class="badge bg-dark px-3 py-2">{{ q.difficulty }}</span>
        </div>
        <p class="text-muted mt-2">Display ID: <strong>{{ q.question_id }}</strong></p>
        <hr>
        
        <p class="lead text-dark">{{ q.description }}</p>

        <div class="row">
            <div class="col-md-6">
                <h5 class="label-heading">Input Format</h5>
                <p>{{ q.input_format }}</p>
            </div>
            <div class="col-md-6">
                <h5 class="label-heading">Output Format</h5>
                <p>{{ q.output_format }}</p>
            </div>
        </div>

        <h5 class="label-heading">Constraints</h5>
        <div class="p-2 bg-light border rounded mb-4"><code>{{ q.constraints }}</code></div>

        <h4 class="fw-bold mt-4 mb-3 text-success">Sample Test Cases</h4>
        <div class="row">
            {% if q.test_cases %}
                {% for case in q.test_cases[:3] %}
                <div class="col-12 mb-3">
                    <div class="card sample-card border-0 shadow-sm overflow-hidden">
                        <div class="card-header bg-light py-1 small fw-bold text-muted">
                            Sample Case #{{ loop.index }}
                        </div>
                        <div class="row g-0">
                            <div class="col-md-6 border-end">
                                <div class="p-3">
                                    <span class="small fw-bold text-secondary text-uppercase" style="font-size: 0.7rem;">Input</span>
                                    <pre class="bg-dark text-white p-2 rounded mt-1">{{ case.input_data }}</pre>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="p-3">
                                    <span class="small fw-bold text-secondary text-uppercase" style="font-size: 0.7rem;">Expected Output</span>
                                    <pre class="bg-dark text-success p-2 rounded mt-1">{{ case.expected_output }}</pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="col-12">
                    <div class="alert alert-warning">No sample test cases provided for this challenge.</div>
                </div>
            {% endif %}
        </div>

        {% if q.explanation %}
        <h5 class="label-heading">Explanation</h5>
        <div class="alert alert-info border-0 shadow-sm">{{ q.explanation }}</div>
        {% endif %}
    </div>

    <div class="compiler-section shadow-sm">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h3 class="fw-bold m-0">Code Editor</h3>
            <select id="language" class="form-select w-25 shadow-sm" onchange="changeLang()">
                <option value="python">Python</option>
                <option value="c">C</option>
                <option value="cpp">C++</option>
                <option value="java">Java</option>
            </select>
        </div>

        <div id="editor" style="height: 400px;"></div>

        <div class="row mt-4">
            <div class="col-md-6">
                <h4 class="fw-bold mb-3">Input (stdin)</h4>
                <textarea id="input" class="form-control mb-3 shadow-sm" rows="5" placeholder="Enter custom test input here..."></textarea>
                <div class="d-grid gap-2 d-md-block">
                    <button class="btn btn-success btn-lg px-5 fw-bold shadow-sm" onclick="runCode()">â–¶ Run Code</button>
                </div>
            </div>
            <div class="col-md-6">
                <h4 class="fw-bold mb-3">Output</h4>
                <pre id="output" class="bg-dark text-success p-3 border-0 rounded shadow-sm" style="min-height: 162px;"></pre>
            </div>
        </div>
    </div>
</div>

<script>
    let editor;

    // Load Monaco Editor
    require.config({
        paths: { vs: "https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs" }
    });

    require(["vs/editor/editor.main"], function () {
        editor = monaco.editor.create(document.getElementById("editor"), {
            value: '# Write Your Python Code here\n',
            language: "python",
            theme: "vs-dark",
            automaticLayout: true,
            scrollBeyondLastLine: false,
            scrollbar: { alwaysConsumeMouseWheel: false },
            contextmenu: false,
            minimap: { enabled: false }
        });

        // Anti-Cheat: Block Copy/Paste/Cut in Editor
        const editorElement = document.getElementById('editor');
        ['copy', 'cut', 'paste', 'contextmenu', 'drop'].forEach(eventType => {
            editorElement.addEventListener(eventType, (e) => {
                e.preventDefault();
                e.stopPropagation();
            }, true);
        });
    });

    // Language templates
    function changeLang() {
        const lang = document.getElementById("language").value;
        let code = "";
        if (lang === "python") code = '# Write Your Code...';
        else if (lang === "c") code = '#include <stdio.h>\n\nint main() {\n    // Write your C code here\n    return 0;\n}';
        else if (lang === "cpp") code = '#include <iostream>\nusing namespace std;\n\nint main() {\n    // Write your C++ code here\n    return 0;\n}';
        else if (lang === "java") code = 'import java.util.*;\n\npublic class Main {\n    public static void main(String[] args) {\n        // Write your Java code here\n    }\n}';

        monaco.editor.setModelLanguage(editor.getModel(), lang === "cpp" ? "cpp" : lang);
        editor.setValue(code);
    }

    // Run code logic
    function runCode() {
        const outputField = document.getElementById("output");
        outputField.textContent = "Compiling and Running...";
        outputField.classList.remove("text-danger");
        outputField.style.color = "#198754"; // Green success color

        fetch("/run", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                code: editor.getValue(),
                language: document.getElementById("language").value,
                input: document.getElementById("input").value
            })
        })
        .then(res => res.json())
        .then(data => {
            if (data.error) {
                outputField.style.color = "#ff4d4d"; // Red error color
                outputField.textContent = data.error;
            } else {
                outputField.textContent = data.output || "Program executed but returned no output.";
            }
        })
        .catch(err => {
            outputField.style.color = "#ff4d4d";
            outputField.textContent = "Fatal: Connection to execution server failed.";
        });
    }
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>